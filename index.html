<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>DeadHope - Dashboard V2</title>
<link href="https://unpkg.com/lucide@latest" rel="stylesheet"/>
<style>
        :root {
            --bg: #1c1c1c;
            --fg: #f5f5f5;
            --accent: #00bcd4;
            --danger: #e74c3c;
        }
        body {
            margin: 0;
            font-family: sans-serif;
            background-color: var(--bg);
            color: var(--fg);
        }
        header {
            padding: 1rem;
            background-color: #111;
            text-align: center;
        }
        nav {
            display: flex;
            gap: 1rem;
            justify-content: center;
            background-color: #222;
            padding: 0.5rem;
        }
        nav a {
            color: var(--fg);
            text-decoration: none;
            padding: 0.5rem 1rem;
            background-color: var(--accent);
            border-radius: 5px;
        }
        section {
            padding: 1rem;
            max-width: 1000px;
            margin: 0 auto;
        }
        h2 {
            border-bottom: 2px solid var(--accent);
            padding-bottom: 0.5rem;
            margin-top: 2rem;
        }
        .danger-grid-wrapper {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1rem;
        }
        .danger-zone-entry {
            display: grid;
            grid-template-columns: 1fr 150px 150px 100px;
            gap: 1rem;
        }
        input, select, button {
            padding: 0.5rem;
            width: 100%;
            box-sizing: border-box;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
    

.character-wrapper {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 1rem;
}
.character-card {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1rem;
    background-color: #2a2a2a;
    padding: 1rem;
    border-radius: 8px;
}
.character-card textarea {
    grid-column: 1 / -1;
    resize: vertical;
    min-height: 60px;
}


    body {
        background-color: #121212;
        background-image: url('https://www.transparenttextures.com/patterns/asfalt-dark.png');
        color: #e0e0e0;
    }
    header {
        background: #222;
        border-bottom: 2px solid #444;
    }
    nav {
        background: #1a1a1a;
    }
    nav a {
        background-color: #8b0000;
        font-weight: bold;
        border: 1px solid #aa0000;
    }
    h1, h2 {
        font-family: 'Courier New', Courier, monospace;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #e74c3c;
    }
    table th, table td {
        border-bottom: 1px solid #444;
    }
    input, select, textarea, button {
        background-color: #222;
        color: #eee;
        border: 1px solid #555;
        font-family: monospace;
    }
    button:hover {
        background-color: #333;
        cursor: pointer;
    }
    #json-input, #json-output {
        background-color: #1a1a1a !important;
        border: 1px solid #444;
        color: #eee !important;
        font-family: monospace;
    }
    
    body {
        font-family: 'Courier New', Courier, monospace;
        background: linear-gradient(#0d0d0d, #1a1a1a);
        color: #d4d4d4;
    }
    h1 {
        font-family: 'Courier New', monospace;
        text-transform: uppercase;
        background: #8b0000;
        padding: 10px;
        text-align: center;
        color: #fff;
        border-radius: 6px;
        box-shadow: 0 0 10px #8b0000;
    }
    h2 {
        color: #ff4;
        font-family: monospace;
    }
    input, select, textarea {
        font-family: monospace;
        background-color: #111;
        color: #0f0;
    }
    
body::before {
  content: "";
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: repeating-linear-gradient(
    0deg,
    rgba(0, 0, 0, 0.1),
    rgba(0, 0, 0, 0.1) 1px,
    transparent 1px,
    transparent 2px
  );
  pointer-events: none;
  z-index: 9999;
}

/* Style spÃ©cifique pour le chat */
#chat-toggle {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #8b0000;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  font-size: 24px;
  color: white;
  border: none;
  cursor: pointer;
  z-index: 10000;
}
#radio-chat {
  display: none;
  position: fixed;
  bottom: 90px;
  right: 20px;
  width: 350px;
  background: #111;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #444;
  z-index: 9999;
}
.fade-in {
  animation: fadeIn 0.4s ease-out forwards;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Styliser les tableaux pour une meilleure lisibilitÃ© */
table {
  width: 100%;
  border-collapse: collapse;
  margin: 1rem 0;
}
th {
  text-align: left;
  background-color: #222;
  padding: 8px;
}
td {
  padding: 8px;
  border-bottom: 1px solid #333;
}
</style>

</head>
<body>

<div id="welcome-screen" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#000;z-index:99999;display:flex;align-items:center;justify-content:center;flex-direction:column;color:#0f0;font-family:'Courier New', monospace;">
  <h1 style="margin-bottom:2rem;">â˜£ï¸ Terminal DeadHope â˜£ï¸</h1>
  <div id="terminal-lines" style="margin-bottom: 1rem; max-width: 80%; text-align: left;"></div>
  <div id="input-zone" style="display: block;">
    <input id="input-pseudo" type="text" placeholder="Entre ton pseudo..." style="padding:10px;background:#111;border:1px solid #444;color:#0f0;font-size:18px;margin-bottom:1rem;width:300px;text-align:center;">
    <button onclick="startDashboard()" style="padding:10px 20px;background:#8b0000;color:#fff;border:none;border-radius:4px;font-size:16px;cursor:pointer;">AccÃ©der au tableau</button>
  </div>
</div>

<!-- Ajout des Ã©lÃ©ments audio manquants -->
<audio id="boot-sound" src="https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg" preload="auto"></audio>
<audio id="confirm-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

<div id="dashboard-content" style="display: block;">
  <div id="last-updated" style="margin:10px 0; color:#aaa; font-size: 0.9em;">DerniÃ¨re mise Ã  jour : jamais</div>
  <header>
    <h1>â˜£ï¸  DeadHope // Terminal de survie â˜£ï¸</h1>
    <div id="weather-info">Chargement mÃ©tÃ©o...</div>
    <div id="game-clock">Heure en jeu : ...</div>
  </header>
  <nav>
    <a href="#skills">CompÃ©tences</a>
    <a href="#zones">Zones dangereuses</a>
    <a href="#map">Carte</a>
    <a href="#" onclick="toggleTheme()">ğŸŒ“</a>
  </nav>
  <main>
    <section id="characters">
      <h2>Fiches de personnage</h2>
      <button onclick="resetSection('character-list')">ğŸ§¹ RÃ©initialiser Fiche de personnages</button>
      <div class="character-wrapper" id="character-list">
        <div class="character-card">
          <input placeholder="Nom" type="text"/>
          <input placeholder="RÃ´le dans le groupe" type="text"/>
          <textarea placeholder="Notes ou observations..."></textarea>
          <button onclick="this.parentElement.remove()">ğŸ—‘ï¸ Supprimer</button>
        </div>
      </div>
      <button onclick="ajouterFichePerso()">â• Ajouter un personnage</button>
    </section>
    <section id="journal">
      <h2>Journal / Ã‰vÃ©nements</h2>
      <input id="filter-journal" oninput="filterTable('filter-journal', 'journal-body')" placeholder="ğŸ” Rechercher..." style="margin-bottom: 10px; padding: 5px; width: 200px; background:#222;color:#fff;border:1px solid #444;"/>
      <table style="width: 100%; table-layout: fixed;">
        <thead>
          <tr>
            <th>Date</th>
            <th>Ã‰vÃ©nement</th>
            <th>Joueur</th>
            <th></th>
          </tr>
        </thead>
        <button onclick="resetSection('journal-body')">ğŸ§¹ RÃ©initialiser Journal d'Ã©vÃ©nements</button>
        <tbody id="journal-body">
          <tr>
            <td><input type="date"/></td>
            <td><input placeholder="Description" type="text"/></td>
            <td><input placeholder="Nom du joueur" type="text"/></td>
            <td><button onclick="this.closest('tr').remove()">ğŸ—‘ï¸</button></td>
          </tr>
        </tbody>
      </table>
      <button onclick="ajouterJournal()">â• Ajouter une entrÃ©e</button>
    </section>
    <section id="priorities">
      <h2>Assignations / PrioritÃ©s</h2>
      <input id="filter-priorites" oninput="filterTable('filter-priorites', 'priority-body')" placeholder="ğŸ” Rechercher..." style="margin-bottom: 10px; padding: 5px; width: 200px; background:#222;color:#fff;border:1px solid #444;"/>
      <table style="width: 100%; table-layout: fixed;">
        <thead>
          <tr>
            <th>TÃ¢che</th>
            <th>Responsable</th>
            <th>Importance</th>
            <th></th>
          </tr>
        </thead>
        <button onclick="resetSection('priority-body')">ğŸ§¹ RÃ©initialiser PrioritÃ©s</button>
        <tbody id="priority-body">
          <tr>
            <td><input placeholder="Ex: Cuisiner, Patrouiller..." type="text"/></td>
            <td><input placeholder="Nom du joueur" type="text"/></td>
            <td>
              <select>
                <option>âšª Faible</option>
                <option>ğŸŸ¡ Moyenne</option>
                <option>ğŸ”´ Haute</option>
              </select>
            </td>
            <td><button onclick="this.closest('tr').remove()">ğŸ—‘ï¸</button></td>
          </tr>
        </tbody>
      </table>
      <button onclick="ajouterPriorite()">â• Ajouter une tÃ¢che</button>
    </section>
    <section id="missions">
      <h2>ğŸ¯ Missions</h2>
      <input id="filter-missions" oninput="filterTable('filter-missions', 'mission-body')" placeholder="ğŸ” Rechercher..." style="margin-bottom: 10px; padding: 5px; width: 200px; background:#222;color:#fff;border:1px solid #444;"/>
      <table style="width: 100%; table-layout: fixed;">
        <thead>
          <tr>
            <th>Objectif</th>
            <th>Responsable</th>
            <th>Ã‰tat</th>
            <th>Deadline</th>
            <th></th>
          </tr>
        </thead>
        <button onclick="resetSection('mission-body')">ğŸ§¹ RÃ©initialiser Missions</button>
        <tbody id="mission-body">
          <tr>
            <td><input placeholder="Ex: Fouiller maison au nord" type="text"/></td>
            <td><input placeholder="Nom du joueur" type="text"/></td>
            <td>
              <select>
                <option>ğŸŸ¡ En cours</option>
                <option>âœ… Fait</option>
                <option>âŒ Ã‰chouÃ©</option>
              </select>
            </td>
            <td><input type="date"/></td>
            <td><button onclick="this.closest('tr').remove()">ğŸ—‘ï¸</button></td>
          </tr>
        </tbody>
      </table>
      <button onclick="ajouterMission()">â• Ajouter une mission</button>
    </section>
    <section id="logistique">
      <h2>ğŸ“¦ Logistique / MatÃ©riel</h2>
      <input id="filter-logistique" oninput="filterTable('filter-logistique', 'logistique-body')" placeholder="ğŸ” Rechercher..." style="margin-bottom: 10px; padding: 5px; width: 200px; background:#222;color:#fff;border:1px solid #444;"/>
      <table style="width: 100%; table-layout: fixed;">
        <thead>
          <tr>
            <th>Type</th>
            <th>Nom</th>
            <th>Ã‰tat</th>
            <th>Emplacement</th>
            <th></th>
          </tr>
        </thead>
        <button onclick="resetSection('logistique-body')">ğŸ§¹ RÃ©initialiser Logistique</button>
        <tbody id="logistique-body">
          <tr>
            <td>
              <select>
                <option>ğŸ”« Arme</option>
                <option>ğŸš— VÃ©hicule</option>
                <option>ğŸ§° Outil</option>
                <option>ğŸ©¹ Soins</option>
                <option>ğŸ“» Ã‰lectronique</option>
              </select>
            </td>
            <td><input placeholder="Nom ou modÃ¨le" type="text"/></td>
            <td>
              <select onchange="checkEtat(this)">
                <option>âœ… Fonctionnel</option>
                <option>âš ï¸ EndommagÃ©</option>
                <option>âŒ Hors service</option>
              </select>
            </td>
            <td><input placeholder="OÃ¹ ? ou Avec qui ?" type="text"/></td>
            <td><button onclick="this.closest('tr').remove()">ğŸ—‘ï¸</button></td>
          </tr>
        </tbody>
      </table>
      <button onclick="ajouterLogistique()">â• Ajouter un item</button>
    </section>
    <section id="skills">
      <h2>CompÃ©tences et responsabilitÃ©s</h2>
      <table style="width:100%; table-layout: fixed;">
        <thead>
          <tr>
            <th>Niveau dans l'Ã©quipe</th>
            <th>Joueur responsable</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input placeholder="Niveau" type="text"/></td>
            <td><input placeholder="Joueur" type="text"/></td>
          </tr>
        </tbody>
      </table>
      <button onclick="ajouterLigneCompetence()">â• Ajouter</button>
    </section>
    <section id="zones">
      <h2>Zones dangereuses</h2>
      <div class="danger-grid-wrapper" id="danger-zone-container">
        <div class="danger-zone-entry">
          <input placeholder="Nom du lieu" type="text"/>
          <select>
            <option>Faible</option>
            <option>ModÃ©rÃ©</option>
            <option>Ã‰levÃ©</option>
            <option>ExtrÃªme</option>
          </select>
          <input placeholder="Informations" type="text"/>
          <button onclick="this.parentElement.remove()">ğŸ—‘ï¸</button>
        </div>
      </div>
      <button onclick="ajouterZoneDangereuse()">â• Ajouter une zone</button>
    </section>
    <section id="map">
      <h2>Carte officielle Project Zomboid</h2>
      <iframe allowfullscreen="" src="https://map.projectzomboid.com/"></iframe>
    </section>
  </main>

  <!-- Bouton chat et section chat -->
  <button id="chat-toggle" onclick="toggleChat()">ğŸ’¬</button>
  <section id="radio-chat" style="display:none;">
    <h2>ğŸ“» Communications radio</h2>
    <div style="margin-bottom: 10px;">
      <input id="chat-input" placeholder="Tape ton message..." style="width:70%;" type="text"/>
      <button onclick="sendMessage()">ğŸ“¡ Envoyer</button>
    </div>
    <div id="chat-log" style="background:#222;padding:10px;max-height:200px;overflow-y:auto;border-radius:8px;border:1px solid #444;"></div>
  </section>
</div>

<!-- Ressources audio -->
<audio id="radio-bip" preload="auto" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

<!-- Scripts -->
<script>
// Fonctions utilitaires
function updateTimestamp() {
  const now = new Date();
  const formatted = now.toLocaleString("fr-FR");
  document.getElementById("last-updated").textContent = "DerniÃ¨re mise Ã  jour : " + formatted;
}

function filterTable(inputId, tableBodyId) {
  const input = document.getElementById(inputId).value.toLowerCase();
  const rows = document.getElementById(tableBodyId).querySelectorAll("tr");
  rows.forEach(row => {
    const text = row.innerText.toLowerCase();
    row.style.display = text.includes(input) ? "" : "none";
  });
}

function resetSection(sectionId) {
  const el = document.getElementById(sectionId);
  if (el) {
    if (sectionId.includes('body')) {
      // Pour les tableaux, on garde la premiÃ¨re ligne comme modÃ¨le
      const firstRow = el.querySelector('tr');
      el.innerHTML = '';
      if (firstRow) {
        const newRow = firstRow.cloneNode(true);
        newRow.querySelectorAll('input').forEach(input => input.value = '');
        newRow.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
        el.appendChild(newRow);
      }
    } else {
      // Pour d'autres conteneurs
      const firstItem = el.children[0];
      el.innerHTML = '';
      if (firstItem) {
        const newItem = firstItem.cloneNode(true);
        newItem.querySelectorAll('input, textarea').forEach(input => input.value = '');
        newItem.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
        el.appendChild(newItem);
      }
    }
  }
  syncToFirebase();
}

// Fonctions de gestion des mÃ©tÃ©o et horloge
async function loadWeather() {
  try {
    const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=47.47&longitude=-0.55&current_weather=true');
    const data = await res.json();
    const weather = data.current_weather || data.current;
    const temperature = weather?.temperature || "N/A";
    const windspeed = weather?.windspeed || "N/A";
    document.getElementById("weather-info").textContent = `ğŸŒ¡ï¸ ${temperature}Â°C | ğŸŒ¬ï¸ ${windspeed} km/h`;
  } catch (e) {
    document.getElementById("weather-info").textContent = "ğŸŒ MÃ©tÃ©o indisponible.";
  }
}

let gameMinutes = 8 * 60;
const gameSpeed = 10;
function updateGameClock() {
  const hours = Math.floor(gameMinutes / 60) % 24;
  const minutes = gameMinutes % 60;
  document.getElementById("game-clock").textContent = `ğŸ•’ Heure en jeu : ${hours.toString().padStart(2, '0')}h${minutes.toString().padStart(2, '0')}`;
  gameMinutes += gameSpeed;
}

// Fonctions d'ajout de contenu
function ajouterFichePerso() {
  const list = document.getElementById("character-list");
  const original = list.children[0];
  const clone = original.cloneNode(true);
  clone.querySelectorAll("input, textarea").forEach(el => el.value = "");
  clone.querySelectorAll("select").forEach(el => el.selectedIndex = 0);
  list.appendChild(clone);
  syncToFirebase();
}

function ajouterJournal() {
  const tbody = document.getElementById("journal-body");
  const clone = tbody.rows[0].cloneNode(true);
  clone.querySelectorAll("input").forEach(el => el.value = "");
  tbody.appendChild(clone);
  syncToFirebase();
}

function ajouterPriorite() {
  const tbody = document.getElementById("priority-body");
  const clone = tbody.rows[0].cloneNode(true);
  clone.querySelectorAll("input").forEach(el => el.value = "");
  clone.querySelector("select").selectedIndex = 0;
  tbody.appendChild(clone);
  syncToFirebase();
}

function ajouterMission() {
  const tbody = document.getElementById("mission-body");
  const clone = tbody.rows[0].cloneNode(true);
  clone.querySelectorAll("input").forEach(el => el.value = "");
  clone.querySelector("select").selectedIndex = 0;
  tbody.appendChild(clone);
  syncToFirebase();
}

function ajouterLogistique() {
  const tbody = document.getElementById("logistique-body");
  const clone = tbody.rows[0].cloneNode(true);
  clone.querySelectorAll("input").forEach(el => el.value = "");
  clone.querySelectorAll("select").forEach(el => el.selectedIndex = 0);
  tbody.appendChild(clone);
  syncToFirebase();
}

function ajouterZoneDangereuse() {
  const container = document.getElementById("danger-zone-container");
  const clone = container.firstElementChild.cloneNode(true);
  clone.querySelectorAll("input").forEach(input => input.value = "");
  container.appendChild(clone);
  syncToFirebase();
}

function ajouterLigneCompetence() {
  const tbody = document.querySelector("#skills table tbody");
  const clone = tbody.rows[0].cloneNode(true);
  clone.querySelectorAll("input").forEach(input => input.value = "");
  tbody.appendChild(clone);
  syncToFirebase();
}

// VÃ©rification de l'Ã©tat des Ã©quipements
function checkEtat(select) {
  const row = select.closest("tr");
  const value = select.value;
  if (value.includes("âŒ")) {
    row.style.backgroundColor = "#4a1c1c";
  } else if (value.includes("âš ï¸")) {
    row.style.backgroundColor = "#4a3c1c";
  } else {
    row.style.backgroundColor = "transparent";
  }
}

// ParamÃ¨tres du thÃ¨me
function toggleTheme() {
  document.body.classList.toggle("light");
}

// Configuration Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDuh0RYk2LHPp_Dc7JCyu-lTOP1kD45xDw",
  authDomain: "deadhope-a1704.firebaseapp.com",
  projectId: "deadhope-a1704",
  storageBucket: "deadhope-a1704.firebasestorage.app",
  messagingSenderId: "1019321338333",
  appId: "1:1019321338333:web:2d2924304d90b0e0f94e34"
};
// Initialisation Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const docRef = db.collection("dashboards").doc("main");

// Fonctions de chat
function toggleChat() {
  const box = document.getElementById("radio-chat");
  box.style.display = box.style.display === "none" ? "block" : "none";
}


function sendMessage() {
  const input = document.getElementById("chat-input");
  const text = input.value.trim();
  if (!text) return;

  const message = {
    pseudo: getPseudo(),
    text,
    timestamp: new Date().toISOString()
  };

  docRef.set({ messages: firebase.firestore.FieldValue.arrayUnion(message) }, { merge: true })
    .then(() => input.value = "")
    .catch(console.error);
}

function renderMessages(messages) {
  const log = document.getElementById("chat-log");
  log.innerHTML = "";

  const cutoff = Date.now() - 1000 * 60 * 60 * 12;
  const recentMessages = messages
    .filter(msg => new Date(msg.timestamp).getTime() > cutoff)
    .sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));

  recentMessages.forEach(msg => {
    const time = new Date(msg.timestamp).toLocaleTimeString("fr-FR", { hour: '2-digit', minute: '2-digit' });
    const div = document.createElement("div");
    div.classList.add("fade-in");
    div.innerHTML = `<strong style="color:#8f8">${msg.pseudo}</strong> <span style="color:#888">[${time}]</span>: ${msg.text}`;
    log.appendChild(div);
  });

  log.scrollTop = log.scrollHeight;
}

// Fonction pour synchroniser les donnÃ©es avec Firebase
function syncToFirebase() {
  updateTimestamp();
  
  // RÃ©cupÃ©ration des donnÃ©es du tableau de bord
  const data = {
    characters: Array.from(document.querySelectorAll("#character-list .character-card")).map(card => ({
      name: card.querySelectorAll("input")[0].value,
      role: card.querySelectorAll("input")[1].value,
      notes: card.querySelector("textarea").value
    })),
    journal: Array.from(document.querySelectorAll("#journal-body tr")).map(row => ({
      date: row.cells[0].querySelector("input")?.value,
      event: row.cells[1].querySelector("input")?.value,
      player: row.cells[2].querySelector("input")?.value
    })),
    priorities: Array.from(document.querySelectorAll("#priority-body tr")).map(row => ({
      task: row.cells[0].querySelector("input")?.value,
      player: row.cells[1].querySelector("input")?.value,
      importance: row.cells[2].querySelector("select")?.value
    })),
    missions: Array.from(document.querySelectorAll("#mission-body tr")).map(row => ({
      objective: row.cells[0].querySelector("input")?.value,
      responsible: row.cells[1].querySelector("input")?.value,
      status: row.cells[2].querySelector("select")?.value,
      deadline: row.cells[3].querySelector("input")?.value
    })),
    logistics: Array.from(document.querySelectorAll("#logistique-body tr")).map(row => ({
      type: row.cells[0].querySelector("select")?.value,
      name: row.cells[1].querySelector("input")?.value,
      status: row.cells[2].querySelector("select")?.value,
      location: row.cells[3].querySelector("input")?.value
    })),
    dangerZones: Array.from(document.querySelectorAll(".danger-zone-entry")).map(entry => ({
      name: entry.querySelector("input:nth-child(1)")?.value,
      level: entry.querySelector("select")?.value,
      info: entry.querySelector("input:nth-child(3)")?.value
    }))
  };
  
  // Sauvegarde dans Firebase
  docRef.update({dashboard: data})
    .catch(error => console.error("Erreur de synchronisation:", error));
}
// Listener pour les messages Firebase
let previousCount = 0;
docRef.onSnapshot(snapshot => {
  const data = snapshot.data();
  if (!data || !Array.isArray(data.messages)) return;

  const messages = data.messages;
  if (messages.length > previousCount) {
    const last = messages[messages.length - 1];
    if (last.pseudo !== getPseudo()) {
      document.getElementById("radio-bip").play().catch(() => {});
    }
  }
  previousCount = messages.length;
  renderMessages(messages);
});

// Ajouter un gestionnaire pour la touche EntrÃ©e sur le chat
document.getElementById("chat-input").addEventListener("keypress", function(event) {
  if (event.key === "Enter") {
    event.preventDefault();
    sendMessage();
  }
});

// Ã‰couter les modifications du contenu pour synchro
document.addEventListener("input", () => syncToFirebase());
document.addEventListener("change", () => syncToFirebase());

// Initialisation au chargement de la page
document.addEventListener("DOMContentLoaded", () => {
  loadWeather();
  updateGameClock();
  setInterval(updateGameClock, 60000);
  
  // Charger les donnÃ©es existantes depuis Firebase
  docRef.get().then(doc => {
    if (doc.exists && doc.data().dashboard) {
      // ImplÃ©menter le chargement des donnÃ©es
      console.log("DonnÃ©es chargÃ©es depuis Firebase");
    }
  }).catch(error => {
    console.error("Erreur lors du chargement des donnÃ©es:", error);
  });
});
</script>

<script>
  window.pseudo = pseudo;
  document.getElementById("welcome-screen").style.display = "none";
  
</script>


<script>
const lines = [
  "Initialisation du protocole DeadHope...",
  "Chargement du systÃ¨me de communication radio...",
  "Synchronisation Firebase Ã©tablie...",
  "Chargement de la carte de Knox Country...",
  "Connexion aux bases de donnÃ©es locales...",
  "Authentification requise pour accÃ©der au terminal."
];

let currentLine = 0;
function typeNextLine() {
  if (currentLine >= lines.length) {
    document.getElementById("input-zone").style.display = "block";
    return;
  }
  const terminal = document.getElementById("terminal-lines");
  const newLine = document.createElement("div");
  newLine.textContent = "";
  terminal.appendChild(newLine);
  let i = 0;
  const text = lines[currentLine];
  const interval = setInterval(() => {
    if (i < text.length) {
      newLine.textContent += text[i++];
    } else {
      clearInterval(interval);
      currentLine++;
      setTimeout(typeNextLine, 500);
    }
  }, 30);
}

window.addEventListener("load", () => {
  document.getElementById("boot-sound").play().catch(() => {});
  typeNextLine();
});

function startDashboard() {
  const input = document.getElementById("input-pseudo");
  const pseudo = input.value.trim();
  if (!pseudo) {
    input.style.border = "1px solid red";
    input.placeholder = "âš ï¸ Entre ton pseudo !";
    return;
  }
  input.disabled = true;
  window.pseudo = pseudo;
  document.getElementById("confirm-sound").play();
  const terminal = document.getElementById("terminal-lines");
  terminal.innerHTML += `\nBienvenue, OPÃ‰RATEUR : ${pseudo.toUpperCase()}\nLancement du terminal...`;
  setTimeout(() => {
    document.getElementById("welcome-screen").style.display = "none";
  }, 2000);
}

function getPseudo() {
  return window.pseudo || "Anonyme";
}

document.getElementById("input-pseudo").addEventListener("keypress", function(e) {
  if (e.key === "Enter") startDashboard();
});
</script>

</body>
</html>
